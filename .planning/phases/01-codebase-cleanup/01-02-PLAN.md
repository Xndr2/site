---
phase: 01-codebase-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/particles.tsx
  - app/blog/[slug]/page.tsx
  - '**/*.ts'
  - '**/*.tsx'
autonomous: true
requirements:
  - CLEAN-02
  - CLEAN-03
  - CLEAN-04

must_haves:
  truths:
    - "particles.tsx has zero occurrences of the word 'any' as a type"
    - 'particles.tsx has zero eslint-disable comments'
    - 'blog/[slug]/page.tsx has zero eslint-disable comments'
    - 'Running `npx prettier --check .` exits 0 with no files listed as needing formatting'
    - 'Running `npx tsc --noEmit` exits 0 with no errors'
    - 'Running `npx eslint .` exits 0 with zero warnings and zero errors'
    - 'Particle animation still renders and responds to mouse movement after useCallback refactor'
  artifacts:
    - path: 'app/components/particles.tsx'
      provides: 'Particle animation with proper Circle[] typing and no eslint-disable'
      contains: 'useRef<Circle[]>'
    - path: 'app/blog/[slug]/page.tsx'
      provides: 'Blog slug page using next/image instead of <img>'
  key_links:
    - from: 'app/components/particles.tsx'
      to: 'Circle type'
      via: 'useRef<Circle[]> — Circle type defined above component'
      pattern: "useRef<Circle\\[\\]>"
    - from: 'particles.tsx useEffect'
      to: 'initCanvas / animate'
      via: 'useCallback with empty deps array'
      pattern: "useCallback\\(.*\\[\\]\\)"
---

<objective>
Fix all TypeScript `any` types project-wide, remove all `eslint-disable` comments by fixing the underlying issues, and apply Prettier formatting across all source files.

Purpose: Make the codebase type-safe, lint-clean, and consistently formatted. These are correctness and maintainability fixes — no behavior changes.
Output: particles.tsx with proper Circle[] typing and useCallback-wrapped functions; blog/[slug]/page.tsx using next/image; all source files Prettier-formatted.
</objective>

<execution_context>
@C:/Users/xndr/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/xndr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix particles.tsx — type safety and ESLint violations</name>
  <files>
    app/components/particles.tsx
  </files>
  <action>
    Read `app/components/particles.tsx` in full first to understand the current structure.

    **Fix 1 — Move Circle type above component:**

    The `Circle` type is currently defined inside the component function body. Move it above the component declaration so it can be used in `useRef<Circle[]>`:

    ```typescript
    type Circle = {
      x: number;
      y: number;
      translateX: number;
      translateY: number;
      size: number;
      alpha: number;
      targetAlpha: number;
      dx: number;
      dy: number;
      magnetism: number;
    };
    ```

    **Fix 2 — Replace `useRef<any[]>` with `useRef<Circle[]>`:**

    Find `const circles = useRef<any[]>([]);` and change to `const circles = useRef<Circle[]>([]);`.

    **Fix 3 — Remove the three `eslint-disable-next-line react-hooks/exhaustive-deps` comments by wrapping `initCanvas` and `animate` with `useCallback`:**

    Add `useCallback` to the React import. Then wrap the internal functions that are listed as missing dependencies:

    - Identify which functions are referenced in useEffect deps that trigger the warning (`initCanvas`, `animate`, and any sub-functions they call)
    - Wrap each with `useCallback(() => { ... }, [])` — use empty deps array because these functions only read from refs (refs don't cause stale closures)
    - Remove each `// eslint-disable-next-line react-hooks/exhaustive-deps` comment
    - Update the useEffect dependency arrays to include the now-stable useCallback references

    **Critical constraint (Pitfall 3):** `initCanvas` and `animate` read from refs (`circles`, `canvasSize`, `dpr`, `mouse` etc.) — not from state. `useCallback` with empty deps `[]` is correct here because refs are always current regardless of deps. Do NOT include state variables in the deps array or you'll create unnecessary re-renders.

    **Fix 4 — Project-wide any sweep:**

    After fixing particles.tsx, run:
    ```
    grep -r ": any" app/ util/ --include="*.ts" --include="*.tsx" -n
    grep -r "as any" app/ util/ --include="*.ts" --include="*.tsx" -n
    grep -r "<any>" app/ util/ --include="*.ts" --include="*.tsx" -n
    ```

    For each remaining `any` found (excluding particles.tsx which is already fixed):
    - Read the file context
    - Apply appropriate fix: use the actual type, `unknown`, a loose interface, or add a `// TODO: type this properly — [reason]` comment if a third-party data shape is genuinely complex
    - Per user decision: "Hard-to-type cases: Claude picks appropriate approach (unknown, loose interface, or TODO)"

    **Verify after each change that `npx tsc --noEmit` still passes** before moving to next fix.

  </action>
  <verify>
    - `grep -n "eslint-disable" app/components/particles.tsx` returns no results
    - `grep -n ": any\|as any\|<any>" app/components/particles.tsx` returns no results
    - `grep -n "useRef<Circle" app/components/particles.tsx` returns one result (the circles ref)
    - `npx tsc --noEmit` exits 0
    - `npx eslint app/components/particles.tsx` exits 0 with no warnings
    - Run `npm run dev` briefly and visually confirm particle background still renders (or note in summary that manual verification is needed)
  </verify>
  <done>particles.tsx has zero `any` types, zero `eslint-disable` comments, properly typed Circle[] ref, and useCallback-wrapped functions; TypeScript and ESLint both pass on this file</done>
</task>

<task type="auto">
  <name>Task 2: Fix blog/[slug]/page.tsx ESLint violation and apply Prettier project-wide</name>
  <files>
    app/blog/[slug]/page.tsx
    "**/*.ts"
    "**/*.tsx"
    "**/*.js"
    "**/*.mjs"
  </files>
  <action>
    **Fix 1 — Remove eslint-disable in blog/[slug]/page.tsx:**

    Read `app/blog/[slug]/page.tsx`. Find the `// eslint-disable-next-line @next/next/no-img-element` comment. The underlying issue is using a raw `<img>` element instead of Next.js `<Image>`. Fix it:

    - Import `Image` from `next/image`: `import Image from 'next/image';`
    - Replace the `<img>` element with `<Image>` — add required props: `src`, `alt`, `width`, `height` (or use `fill` with a positioned container if dimensions aren't known)
    - If the image dimensions are unknown at build time (e.g., from MDX frontmatter), use `width={800} height={400}` as reasonable defaults for blog post header images, or use `fill` layout with `className="object-cover"` inside a `relative` container
    - Remove the `// eslint-disable-next-line @next/next/no-img-element` comment
    - Ensure `alt` text is set from the actual image alt attribute (not hardcoded)

    After this fix, run `npx eslint .` to find any remaining eslint-disable comments or new violations across the whole codebase:
    ```
    grep -r "eslint-disable" app/ util/ --include="*.ts" --include="*.tsx" -n
    ```
    Fix each remaining one by addressing the root cause (per user decision: fix underlying issues, not delete rules).

    **Fix 2 — Apply Prettier project-wide:**

    Run the existing format script:
    ```
    npm run format
    ```

    This runs `prettier --write .` and fixes all 32 files with violations in one pass.

    After formatting, review the git diff to ensure:
    - No MDX blog post content was mangled (check `content/posts/*.mdx`)
    - No JSON/config files have unexpected restructuring
    - If `.prettierignore` does not already exclude `content/posts/`, and if MDX formatting changed in a way that could break rendering, add `content/posts/` to `.prettierignore` and re-run format

    **Final lint and type check:**
    ```
    npx eslint .
    npx tsc --noEmit
    npm run build
    ```
    All three must exit 0.

  </action>
  <verify>
    - `grep -r "eslint-disable" app/ util/ --include="*.ts" --include="*.tsx" -rn` returns no results
    - `npx prettier --check .` exits 0 (no files need formatting)
    - `npx eslint .` exits 0 with no warnings or errors
    - `npx tsc --noEmit` exits 0
    - `npm run build` exits 0
  </verify>
  <done>All eslint-disable comments removed (root causes fixed); Prettier applied across all source files; ESLint, TypeScript, and build all pass clean</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -r "eslint-disable" app/ util/ --include="*.ts" --include="*.tsx"` returns zero results
2. `grep -r ": any\|as any\|<any>" app/ util/ --include="*.ts" --include="*.tsx"` returns zero results (or only TODO-annotated cases)
3. `npx prettier --check .` exits 0
4. `npx eslint .` exits 0
5. `npx tsc --noEmit` exits 0
6. `npm run build` exits 0
</verification>

<success_criteria>

- particles.tsx: zero `any` types, zero `eslint-disable` comments, Circle[] typed ref, useCallback-wrapped functions
- blog/[slug]/page.tsx: next/image used instead of raw img, no eslint-disable comment
- All source files Prettier-formatted (npx prettier --check . passes)
- All ESLint rules pass with no suppressions (npx eslint . exits 0)
- TypeScript compiles clean (npx tsc --noEmit exits 0)
- Build passes
  </success_criteria>

<output>
After completion, create `.planning/phases/01-codebase-cleanup/01-02-SUMMARY.md` documenting:
- What any types were found project-wide and how each was fixed
- The useCallback approach used in particles.tsx (deps arrays, which functions were wrapped)
- What the blog/[slug] img-to-Image change looked like (dimensions used, layout approach)
- Any remaining TODOs left for hard-to-type cases and why
- Prettier: how many files were reformatted, any MDX concerns
</output>
