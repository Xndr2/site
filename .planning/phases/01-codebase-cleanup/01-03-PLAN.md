---
phase: 01-codebase-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lib/github.ts
  - app/lib/blog.ts
autonomous: true
requirements:
  - CLEAN-05
  - CLEAN-06

must_haves:
  truths:
    - 'github.ts has no try/catch that swallows errors — fetch failures throw and bubble up'
    - 'github.ts has zero console.error or console.log calls'
    - 'blog.ts has no try/catch that returns [] from an error path (I/O errors throw; empty-posts-dir returns [] as valid empty state)'
    - 'blog.ts has zero console.error or console.log calls'
    - 'When GitHub API fails (non-200 response), an Error is thrown with the HTTP status in the message'
  artifacts:
    - path: 'app/lib/github.ts'
      provides: 'GitHub API client that throws on failure'
      contains: 'throw new Error'
    - path: 'app/lib/blog.ts'
      provides: 'Blog loader that throws on I/O errors but returns [] for empty posts dir'
  key_links:
    - from: 'app/lib/github.ts'
      to: 'app/projects/page.tsx'
      via: 'fetchGitHubRepos() called in server component — throws propagate to error.tsx'
      pattern: 'fetchGitHubRepos'
    - from: 'app/lib/blog.ts'
      to: 'app/blog/page.tsx'
      via: 'getAllPosts() — empty [] is valid; MDX parse errors in getPostBySlug throw'
      pattern: 'getAllPosts|getPostBySlug'
---

<objective>
Replace silent failure patterns in github.ts and blog.ts with proper error propagation, and remove all console.error/console.log from production code paths.

Purpose: When the GitHub API fails, users currently see an empty projects page with no indication of a problem. After this fix, errors will propagate to the error.tsx boundaries added in Plan 04, where users will see a visible error state. This is the prerequisite for Plan 04.
Output: github.ts and blog.ts that throw on failures; no console logging in production paths.
</objective>

<execution_context>
@C:/Users/xndr/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/xndr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix github.ts — remove silent catch blocks and console.error calls</name>
  <files>
    app/lib/github.ts
  </files>
  <action>
    Read `app/lib/github.ts` in full first.

    **Problem (current pattern):**
    The file has try/catch blocks that catch fetch errors and return `[]` (empty array) with a `console.error` call. This means GitHub API failures are invisible to users — the projects page just renders empty.

    **Fix — Remove try/catch, let errors propagate:**

    For `fetchGitHubRepos()` (and any other exported functions with the same pattern):
    1. Remove the outer try/catch block entirely
    2. Keep the `if (!response.ok)` check but change it to throw:
       ```typescript
       if (!response.ok) {
         throw new Error(`GitHub API returned ${response.status}`);
       }
       ```
    3. Remove any `console.error(...)` calls — both the ones inside catch blocks and any standalone ones (lines 60 and 101 per research findings)
    4. Remove any `console.log(...)` calls from this file

    The corrected structure for `fetchGitHubRepos`:
    ```typescript
    export async function fetchGitHubRepos(): Promise<ProcessedRepo[]> {
      const response = await fetch(
        `${GITHUB_API_BASE}/users/${GITHUB_USERNAME}/repos?sort=updated&per_page=100`,
        {
          headers: { Accept: 'application/vnd.github.v3+json' },
          next: { revalidate: 86400 },
        }
      );

      if (!response.ok) {
        throw new Error(`GitHub API returned ${response.status}`);
      }

      const repos: GitHubRepo[] = await response.json();
      // ... rest of processing unchanged
    }
    ```

    **Check for other functions in github.ts** that follow the same silent-failure pattern (multiple functions may use the same pattern) — fix all of them.

    **Verify no console statements remain:**
    ```
    grep -n "console\." app/lib/github.ts
    ```
    Must return no results.

    **TypeScript check after edit:**
    ```
    npx tsc --noEmit
    ```
    Must exit 0 — ensure removing try/catch doesn't cause type narrowing issues with the response type.

  </action>
  <verify>
    - `grep -n "console\." app/lib/github.ts` returns no results
    - `grep -n "return \[\]" app/lib/github.ts` returns no results from within catch blocks (the only valid `return []` would be explicit empty-state logic, not error swallowing)
    - `grep -n "throw new Error" app/lib/github.ts` returns at least one result (the !response.ok check)
    - `npx tsc --noEmit` exits 0
  </verify>
  <done>github.ts throws on API failures (non-200 responses and network errors); zero console statements remain; TypeScript passes</done>
</task>

<task type="auto">
  <name>Task 2: Fix blog.ts — distinguish empty-state from I/O errors, remove console statements</name>
  <files>
    app/lib/blog.ts
  </files>
  <action>
    Read `app/lib/blog.ts` in full first.

    **Critical distinction (Pitfall 2 from research):**
    `blog.ts` has two different behaviors that must be handled differently:

    - `getAllPosts()` — calls `ensurePostsDir()` which auto-creates the directory. Returning `[]` for an empty posts directory is CORRECT behavior (not a bug). This function does NOT need to throw for empty state. However, actual I/O errors (permissions, disk failures) should NOT be silently swallowed.

    - `getPostBySlug()` — parses MDX with gray-matter. A malformed frontmatter or missing file should throw so the [slug]/error.tsx boundary can catch it.

    **Fix strategy:**

    For `getAllPosts()`:
    - Keep the `return []` for empty directory case (this is valid empty state)
    - But remove any `console.error` calls and ensure real I/O errors (not empty-dir) propagate
    - If the current try/catch catches ALL errors and returns `[]`, refactor to:
      - Only catch the "directory does not exist" case (if ensurePostsDir doesn't already handle it) and return `[]`
      - Let other errors (permissions, disk I/O) propagate naturally by NOT catching them

    For `getPostBySlug()`:
    - Remove try/catch that swallows parsing errors
    - Let MDX parsing errors throw naturally — the [slug]/error.tsx boundary will catch them

    **Remove all console statements:**
    ```
    grep -n "console\." app/lib/blog.ts
    ```
    Remove every `console.error`, `console.log`, `console.warn` found.

    **After edits:**
    ```
    npx tsc --noEmit
    npm run build
    ```
    Both must pass. The build is the real test — it actually runs the blog post loading pipeline.

  </action>
  <verify>
    - `grep -n "console\." app/lib/blog.ts` returns no results
    - `npx tsc --noEmit` exits 0
    - `npm run build` exits 0 (blog posts load correctly during build — existing 3 MDX posts must compile)
    - Blog list page still works: build output shows /blog route successfully pre-rendered
  </verify>
  <done>blog.ts returns [] for empty posts dir (valid state) but lets I/O and parse errors propagate; zero console statements; build passes with existing MDX posts</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -rn "console\." app/lib/` returns no results
2. `grep -n "return \[\]" app/lib/github.ts` — any remaining [] returns are NOT inside catch blocks (no silent swallowing)
3. `npx tsc --noEmit` exits 0
4. `npm run build` exits 0 — all existing routes (including /projects and /blog) build successfully
</verification>

<success_criteria>

- github.ts: no console statements, throws on non-200 responses and network errors
- blog.ts: no console statements, getAllPosts() returns [] for empty dir (valid), getPostBySlug() throws on parse errors
- TypeScript compiles clean
- Build succeeds — existing pages still render correctly
- Error propagation is ready for error.tsx boundaries (Plan 04)
  </success_criteria>

<output>
After completion, create `.planning/phases/01-codebase-cleanup/01-03-SUMMARY.md` documenting:
- Exact changes made to github.ts (which functions changed, what the catch blocks contained)
- Exact changes made to blog.ts (how getAllPosts vs getPostBySlug were treated differently)
- How many console statements were removed from each file
- TypeScript or build issues encountered and how they were resolved
</output>
